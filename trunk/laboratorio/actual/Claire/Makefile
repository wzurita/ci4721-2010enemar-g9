######################################################################
# Claire a parser generator.                                         #
# Copyright (C) 1999  Paul Pacheco <93-25642@ldc.usb.ve>             #
#                                                                    #
# This library is free software; you can redistribute it and/or      #
# modify it under the terms of the GNU Lesser General Public         #
# License as published by the Free Software Foundation; either       #
# version 2 of the License, or (at your option) any later version.   #
#                                                                    #
# This library is distributed in the hope that it will be useful,    #
# but WITHOUT ANY WARRANTY; without even the implied warranty of     #
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU  #
# Lesser General Public License for more details.                    #
#                                                                    #
# You should have received a copy of the GNU Lesser General Public   #
# License along with this library; if not, write to the Free         #
# Software Foundation, Inc., 59 Temple Place, Suite 330,             #
# Boston, MA  02111-1307  USA                                        #
#                                                                    #
# Please contact Paul Pacheco <93-25642@ldc.usb.ve> to submit any    #
# suggestion or bug report.                                          #
######################################################################

# $Id: Makefile,v 1.5 1999/11/07 11:44:04 Paul Exp $
# 
# the changes to this file are
#
# $Log: Makefile,v $
# Revision 1.5  1999/11/07 11:44:04  Paul
# changed the name of the translator from JAVA to java.
# Also improved the package hieritachy, now the java translator
# is completely under ve.usb.Claire.translator.java
#
# Revision 1.4  1999/11/06 01:43:01  Paul
# Made the JAVA translator easier,
# improved the makefile
# Improved the runtime library
#
# Revision 1.3  1999/11/01 09:47:11  Paul
# Starting to add exception suport
#
# Revision 1.2  1999/11/01 07:06:12  Paul
# Simplified the make file
#
# Revision 1.1.1.1  1999/10/31 07:47:02  Paul
# Imported Claire files
#
# Revision 1.2  1999/09/09 09:12:25  Paul
# added cvs commands and now cleans even backup files generated by emacs
#

ifndef JAVAC
	JAVAC=javac
endif

ifdef DEBUG
	JAVAC+= -g
endif

#DIR:=$(shell pwd)
#NEWCLASSPATH:=$(DIR):$(CLASSPATH)

ifndef CLAIRE
	CLAIRE=Claire
endif

ifdef DEBUG
	CLAIRE+= --perf
endif

ifndef JAVA
	JAVA=java
endif

#export JAVAC
#export JAVA
#export NEWCLASSPATH
#export CLAIRE

#COMMON:=$(DIR)/Makefile.common

.SUFFIXES: .class .java .clr

%.class : %.java
	@echo compiling $<
	@$(JAVAC) $<

ifdef DEBUG

%.java : %.clr
	@echo compiling $<
	@$(CLAIRE) -v $(<D)/verbose $<
else
%.java : %.clr
	@echo compiling $<
	@$(CLAIRE) $<

endif

PARSERS:=$(shell find . -name "*.clr")
COMPILEDPARSERS:=$(patsubst %.clr,%.java, $(PARSERS))
JAVASOURCES:=$(COMPILEDPARSERS) $(shell find . -name "*.java")
CLASSFILES:=$(patsubst %.java,%.class, $(JAVASOURCES))

all: Runtime.jar Claire.jar

compile: $(COMPILEDPARSERS) $(CLASSFILES)

Runtime.jar: compile $(filter ./ve/usb/Claire/runtime/%.class,$(CLASSFILES))
	@echo Creating $@
	@jar -cvf Runtime.jar `find ve/usb/Claire/runtime -name "*.class"`


Claire.jar: compile $(CLASSFILES) $(shell find . -name "*.list") $(shell find . -name "Message*") MANIFEST.MF
	@echo Creating $@
	@jar -cmvf MANIFEST.MF $@ `find . -name "*.class"` `find . -name "*.list"` `find . -name "Message*"` `find . -name "*.tpl"`

cleanGrammars: 
	@echo Deleting Grammars
	@$(RM) $(COMPILEDPARSERS)

clean: cleanGrammars
	@echo Deleting compiled classes
	@$(RM) $(CLASSFILES)
	@$(RM) `find . -name "*.class"`
	@$(RM) `find . -name "*~"`

fullclean: clean
	@echo Deleting Jar files
	@$(RM) *.jar

.PHONY: clean compile all cleanGrammars fullclean
